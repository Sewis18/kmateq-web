<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <!-- Permite que se adapte en dispositivos móviles -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ejecución de Servicio - KMATEQ</title>
  <!-- Fuente moderna: Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Reset básico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    /* Fondo animado claro y elegante */
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(45deg, #f9fafb, #e2e8f0, #cbd5e1, #f9fafb);
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease-in-out infinite;
      color: #2c3e50;
      padding: 20px;
    }
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Contenedor principal (position: relative para la imagen en la esquina) */
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease-in-out;
      position: relative;
    }
    .container:hover {
      transform: scale(1.02);
    }
    /* Imagen en la esquina superior izquierda siempre grande y moderna */
    .corner-img {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 150px;
      height: auto;
      z-index: 100;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    /* Títulos */
    h1 {
      text-align: center;
      color: #3498db;
      margin-bottom: 20px;
    }
    /* Agrupación para mostrar en línea */
    .form-row {
      display: flex;
      gap: 20px;
    }
    .form-row .form-group {
      flex: 1;
    }
    /* Grupos del formulario */
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      color: #3498db;
      margin-bottom: 8px;
    }
    /* Inputs, select y textarea */
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: #fefefe;
      color: #2c3e50;
      margin-bottom: 10px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #3498db;
      box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
      outline: none;
    }
    textarea {
      resize: vertical;
      min-height: 130px;
    }
    /* Canvas para firma */
    canvas {
      border: 2px solid #3498db;
      background: #fff;
      border-radius: 5px;
      display: block;
      margin-bottom: 10px;
      touch-action: none;
      width: 100%;
      max-width: 300px;
    }
    /* Botones */
    button {
      padding: 12px 24px;
      background: #3498db;
      border: none;
      border-radius: 5px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      margin: 5px;
      transition: background 0.3s, transform 0.3s;
    }
    button:hover {
      background: #2980b9;
      transform: scale(1.02);
    }
    /* Estilos para el grupo de radio buttons */
    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
      color: #3498db;
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .radio-group input[type="radio"] {
      transform: scale(1.2);
    }
    /* Área de impresión (vista previa) */
    .print-area {
      display: none;
    }
    .print-area table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 1.1rem;
    }
    /* Encabezado de la tabla con una única celda */
    .print-area th {
      background: #3498db;
      color: #fff;
      padding: 12px;
      text-align: center;
    }
    .print-area td {
      border: 1px solid #3498db;
      padding: 12px;
      text-align: left;
    }
    .print-area tr:nth-child(even) {
      background: #f2f2f2;
    }
    .print-area img {
      width: 100%;
      max-width: 300px;
      height: auto;
      display: block;
      margin: auto;
    }
    /* Elementos que no se imprimen */
    .no-print { }
    /* Modo impresión */
    @media print {
      .no-print {
        display: none;
      }
      .print-area {
        display: block;
      }
      .container {
        box-shadow: none;
        border: none;
        margin: 0;
        padding: 10px;
      }
    }
    /* Adaptación para dispositivos móviles */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.6rem;
      }
      .container {
        padding: 15px;
      }
      button {
        font-size: 0.9rem;
        padding: 10px 15px;
      }
      .print-area table {
        font-size: 0.9rem;
        display: block;
        overflow-x: auto;
      }
      .form-row {
        flex-direction: column;
      }
      /* Layout de los radio buttons en cuadrícula */
      .radio-group {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      .radio-group label {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Imagen posicionada en la esquina superior izquierda -->
    <img src="KMATEQ.png" alt="KMATEQ" class="corner-img">
    
    <!-- Título visible únicamente en pantalla (no se imprime en vista previa) -->
    <h1 class="no-print">Ejecución de Servicio</h1>
    
    <!-- Formulario de ingreso (no se imprime) -->
    <form id="serviceForm" class="no-print">
      <!-- Agrupación de Fecha y Nombre del solicitante en una misma línea -->
      <div class="form-row">
        <div class="form-group">
          <label for="fecha">Fecha:</label>
          <input type="date" id="fecha" name="fecha" required />
        </div>
        <div class="form-group">
          <label for="nombreSolicitante">Nombre del solicitante:</label>
          <select id="nombreSolicitante" name="nombreSolicitante" required>
            <option value="" disabled selected>Seleccione una opción</option>
            <option value="Asonest">Asonest</option>
            <option value="Serviases">Serviases</option>
            <option value="Surtipharma">Surtipharma</option>
            <option value="Dissan">Dissan</option>
            <option value="Dizar">Dizar</option>
            <option value="As Analitycal">As Analitycal</option>
            <option value="Embriovet">Embriovet</option>
            <option value="Farbroquim">Farbroquim</option>
            <option value="Gaia Vitares">Gaia Vitares</option>
            <option value="Liceo De Los Andes A e Inmobiliaria Cartongraf">Liceo De Los Andes A e Inmobiliaria Cartongraf</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Evaluación del servicio:</label>
        <div class="radio-group">
          <label>
            <input type="radio" name="evaluacion" value="Excelente" required /> Excelente
          </label>
          <label>
            <input type="radio" name="evaluacion" value="Bueno" /> Bueno
          </label>
          <label>
            <input type="radio" name="evaluacion" value="Regular" /> Regular
          </label>
          <label>
            <input type="radio" name="evaluacion" value="Deficiente" /> Deficiente
          </label>
        </div>
      </div>
      <div class="form-group">
        <label for="descripcionActividad">Descripción de la actividad:</label>
        <textarea id="descripcionActividad" name="descripcionActividad" required></textarea>
      </div>
      <div class="form-group">
        <label for="horaLlegada">Hora llegada:</label>
        <input type="time" id="horaLlegada" name="horaLlegada" required />
      </div>
      <div class="form-group">
        <label for="horaSalida">Hora salida:</label>
        <input type="time" id="horaSalida" name="horaSalida" required />
      </div>
      <div class="form-group">
        <label>Firma de quien recibe:</label>
        <canvas id="firmaRecibido" width="300" height="150"></canvas>
        <button type="button" onclick="clearCanvas('firmaRecibido')">Limpiar Firma</button>
      </div>
      <div class="form-group">
        <label>Firma de quien realiza:</label>
        <canvas id="firmaRealizado" width="300" height="150"></canvas>
        <button type="button" onclick="clearCanvas('firmaRealizado')">Limpiar Firma</button>
      </div>
      <div style="text-align: center;">
        <button type="submit">Generar Vista Previa</button>
        <button type="button" onclick="window.print()">Imprimir PDF</button>
      </div>
    </form>
    
    <!-- Área de vista previa para impresión -->
    <div id="printArea" class="print-area">
      <!-- Encabezado modificado: una única celda con colspan=2 -->
      <table>
        <tr>
          <th colspan="2">DESCRIPCION DE LA ACTIVIDAD</th>
        </tr>
        <tr>
          <td>Fecha</td>
          <td id="pFecha"></td>
        </tr>
        <tr>
          <td>Nombre del solicitante</td>
          <td id="pNombreSolicitante"></td>
        </tr>
        <tr>
          <td>Evaluación del servicio</td>
          <td id="pEvaluacion"></td>
        </tr>
        <tr>
          <td>Descripción de la actividad</td>
          <td id="pDescripcionActividad"></td>
        </tr>
        <tr>
          <td>Hora llegada</td>
          <td id="pHoraLlegada"></td>
        </tr>
        <tr>
          <td>Hora salida</td>
          <td id="pHoraSalida"></td>
        </tr>
        <tr>
          <td>Firma de quien recibe</td>
          <td>
            <img id="pFirmaRecibido" alt="Firma de quien recibe" />
          </td>
        </tr>
        <tr>
          <td>Firma de quien realiza</td>
          <td>
            <img id="pFirmaRealizado" alt="Firma de quien realiza" />
          </td>
        </tr>
      </table>
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()">Imprimir PDF</button>
        <button onclick="volverInicio()">Volver al Inicio</button>
      </div>
    </div>
  </div>
  
  <script>
    // Función para obtener coordenadas (soporte para mouse y touch)
    function getCoordinates(e, canvas) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches && e.touches.length > 0) {
        return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
      } else {
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
      }
    }
    
    // Función para convertir una hora en formato 24h (HH:MM) a formato 12h con AM/PM
    function convertTo12Hour(time24) {
      const parts = time24.split(":");
      let hour = parseInt(parts[0], 10);
      const minutes = parts[1];
      const suffix = hour >= 12 ? "PM" : "AM";
      hour = hour % 12;
      if (hour === 0) { hour = 12; }
      return hour + ":" + minutes + " " + suffix;
    }
    
    // Inicializa la funcionalidad para firmar en un canvas
    function initSignatureCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      let drawing = false;
    
      function startDrawing(e) {
        drawing = true;
        const pos = getCoordinates(e, canvas);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
      }
    
      function draw(e) {
        if (!drawing) return;
        e.preventDefault();
        const pos = getCoordinates(e, canvas);
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
      }
    
      function stopDrawing() {
        drawing = false;
        ctx.beginPath();
      }
    
      canvas.addEventListener("mousedown", startDrawing);
      canvas.addEventListener("mousemove", draw);
      canvas.addEventListener("mouseup", stopDrawing);
      canvas.addEventListener("mouseleave", stopDrawing);
      // Soporte para eventos táctiles
      canvas.addEventListener("touchstart", startDrawing, { passive: true });
      canvas.addEventListener("touchmove", draw, { passive: false });
      canvas.addEventListener("touchend", stopDrawing, { passive: true });
    }
    
    // Función para limpiar el canvas
    function clearCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    
    // Inicializamos los canvas para las firmas
    initSignatureCanvas("firmaRecibido");
    initSignatureCanvas("firmaRealizado");
    
    // Evento del formulario: copia los datos al área de impresión y convierte las firmas en imágenes
    document.getElementById("serviceForm").addEventListener("submit", function (e) {
      e.preventDefault();
      document.getElementById("pFecha").textContent = document.getElementById("fecha").value;
      document.getElementById("pNombreSolicitante").textContent = document.getElementById("nombreSolicitante").value;
      document.getElementById("pEvaluacion").textContent = document.querySelector('input[name="evaluacion"]:checked').value;
      document.getElementById("pDescripcionActividad").textContent = document.getElementById("descripcionActividad").value;
      
      // Convertir las horas de 24h a 12h con AM/PM
      const horaLlegada24 = document.getElementById("horaLlegada").value;
      const horaSalida24 = document.getElementById("horaSalida").value;
      document.getElementById("pHoraLlegada").textContent = convertTo12Hour(horaLlegada24);
      document.getElementById("pHoraSalida").textContent = convertTo12Hour(horaSalida24);
      
      const firmaRecibidoImg = document.getElementById("firmaRecibido").toDataURL();
      const firmaRealizadoImg = document.getElementById("firmaRealizado").toDataURL();
      document.getElementById("pFirmaRecibido").src = firmaRecibidoImg;
      document.getElementById("pFirmaRealizado").src = firmaRealizadoImg;
      
      // Ocultar el formulario y mostrar el área de vista previa
      document.getElementById("serviceForm").style.display = "none";
      document.getElementById("printArea").style.display = "block";
    });
    
    // Función para volver al inicio
    function volverInicio() {
      location.reload();
    }
  </script>
</body>
</html>