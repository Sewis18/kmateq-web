<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <!-- Permite que se adapte en dispositivos móviles -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ejecución de Servicio - KMATEQ</title>
  <!-- Fuente moderna: Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Reset básico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    /* Fondo animado oscuro y elegante */
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(45deg, #0d0d0d, #2c3e50, #2ecc71, #0d0d0d);
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease infinite;
      color: #e0e0e0;
      padding: 20px;
    }
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    /* Contenedor principal */
    .container {
      max-width: 900px;
      margin: auto;
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 0 12px rgba(0,0,0,0.8);
      transition: transform 0.3s ease-in-out;
    }
    .container:hover {
      transform: scale(1.02);
    }
    /* Títulos */
    h1 {
      text-align: center;
      color: #2ecc71;
      margin-bottom: 20px;
    }
    /* Grupos del formulario */
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-weight: 600;
      color: #2ecc71;
      margin-bottom: 8px;
    }
    /* Inputs y textarea */
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #444;
      border-radius: 5px;
      background: #121212;
      color: #fff;
      margin-bottom: 10px;
      transition: border-color 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #2ecc71;
      outline: none;
    }
    textarea {
      resize: vertical;
      min-height: 130px;
    }
    /* Canvas para firma */
    canvas {
      border: 2px solid #2ecc71;
      background: #121212;
      border-radius: 5px;
      display: block;
      margin-bottom: 10px;
      touch-action: none;
      width: 100%;
      max-width: 300px;
    }
    /* Botones */
    button {
      padding: 12px 24px;
      background: #2ecc71;
      border: none;
      border-radius: 5px;
      color: #121212;
      font-weight: 600;
      cursor: pointer;
      margin: 5px;
      transition: background 0.3s;
    }
    button:hover {
      background: #27ae60;
    }
    /* Área de impresión (vista previa) */
    .print-area {
      display: none;
    }
    .print-area h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #2ecc71;
      font-size: 1.8rem;
    }
    .print-area table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 1.1rem;
    }
    .print-area th, .print-area td {
      border: 1px solid #2ecc71;
      padding: 12px;
      text-align: left;
    }
    .print-area th {
      background: #2ecc71;
      color: #121212;
    }
    .print-area tr:nth-child(even) {
      background: #2a2a2a;
    }
    /* Elementos que no se imprimen */
    .no-print { }
    /* Modo impresión */
    @media print {
      .no-print {
        display: none;
      }
      .print-area {
        display: block;
      }
      .container {
        box-shadow: none;
        border: none;
        margin: 0;
        padding: 10px;
      }
    }
    /* Adaptación para dispositivos móviles */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.6rem;
      }
      .container {
        padding: 15px;
      }
      button {
        font-size: 0.9rem;
        padding: 10px 15px;
      }
      .print-area table {
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Título visible únicamente en pantalla -->
    <h1 class="no-print">Ejecución de Servicio</h1>
    <!-- Formulario de ingreso (no se imprime) -->
    <form id="serviceForm" class="no-print">
      <div class="form-group">
        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha" name="fecha" required />
      </div>
      <div class="form-group">
        <label for="nombreSolicitante">Nombre del solicitante:</label>
        <select id="nombreSolicitante" name="nombreSolicitante" required>
          <option value="" disabled selected>Seleccione una opción</option>
          <option value="serviases">serviases</option>
          <option value="Asonest">Asonest</option>
          <option value="PAF">PAF</option>
          <option value="AEinmobiliaria">AEinmobiliaria</option>
          <option value="Gaia vitares">Gaia vitares</option>
          <option value="Surtipharma">Surtipharma</option>
          <option value="Cartongraf">Cartongraf</option>
          <option value="Liceo de los andes">Liceo de los andes</option>
          <option value="Analitical">Analitical</option>
          <option value="Dizar">Dizar</option>
          <option value="Dissan">Dissan</option>
        </select>
      </div>
      <div class="form-group">
        <label>Evaluación del servicio:</label>
        <div>
          <label>
            <input type="radio" name="evaluacion" value="Excelente" required /> Excelente
          </label>
          <label>
            <input type="radio" name="evaluacion" value="Bueno" /> Bueno
          </label>
          <label>
            <input type="radio" name="evaluacion" value="Regular" /> Regular
          </label>
          <label>
            <input type="radio" name="evaluacion" value="Deficiente" /> Deficiente
          </label>
        </div>
      </div>
      <div class="form-group">
        <label for="descripcionActividad">Descripción de la actividad:</label>
        <textarea id="descripcionActividad" name="descripcionActividad" required></textarea>
      </div>
      <div class="form-group">
        <label for="horaLlegada">Hora llegada:</label>
        <input type="time" id="horaLlegada" name="horaLlegada" required />
      </div>
      <div class="form-group">
        <label for="horaSalida">Hora salida:</label>
        <input type="time" id="horaSalida" name="horaSalida" required />
      </div>
      <div class="form-group">
        <label>Firma de quien recibe:</label>
        <canvas id="firmaRecibido" width="300" height="150"></canvas>
        <button type="button" onclick="clearCanvas('firmaRecibido')">Limpiar Firma</button>
      </div>
      <div class="form-group">
        <label>Firma de quien realiza:</label>
        <canvas id="firmaRealizado" width="300" height="150"></canvas>
        <button type="button" onclick="clearCanvas('firmaRealizado')">Limpiar Firma</button>
      </div>
      <div style="text-align: center;">
        <button type="submit">Generar Vista Previa</button>
        <!-- Este botón se muestra mientras se visualiza el formulario -->
        <button type="button" onclick="window.print()">Imprimir PDF</button>
      </div>
    </form>
    <!-- Área de vista previa para impresión -->
    <div id="printArea" class="print-area">
      <h1>Ejecución de Servicio KMATEQ</h1>
      <table>
        <tr>
          <th>Campo</th>
          <th>Información</th>
        </tr>
        <tr>
          <td>Fecha</td>
          <td id="pFecha"></td>
        </tr>
        <tr>
          <td>Nombre del solicitante</td>
          <td id="pNombreSolicitante"></td>
        </tr>
        <tr>
          <td>Evaluación del servicio</td>
          <td id="pEvaluacion"></td>
        </tr>
        <tr>
          <td>Descripción de la actividad</td>
          <td id="pDescripcionActividad"></td>
        </tr>
        <tr>
          <td>Hora llegada</td>
          <td id="pHoraLlegada"></td>
        </tr>
        <tr>
          <td>Hora salida</td>
          <td id="pHoraSalida"></td>
        </tr>
        <tr>
          <td>Firma de quien recibe</td>
          <td>
            <img id="pFirmaRecibido" alt="Firma de quien recibe" style="max-width:300px; border:1px solid #2ecc71;" />
          </td>
        </tr>
        <tr>
          <td>Firma de quien realiza</td>
          <td>
            <img id="pFirmaRealizado" alt="Firma de quien realiza" style="max-width:300px; border:1px solid #2ecc71;" />
          </td>
        </tr>
      </table>
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()">Imprimir PDF</button>
        <button onclick="volverInicio()">Volver al Inicio</button>
      </div>
    </div>
  </div>
  <script>
    // Función para obtener coordenadas (soporte mouse y touch)
    function getCoordinates(e, canvas) {
      const rect = canvas.getBoundingClientRect();
      if (e.touches && e.touches.length > 0) {
        return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
      } else {
        return { x: e.clientX - rect.left, y: e.clientY - rect.top };
      }
    }

    // Inicializa la funcionalidad para firmar en un canvas
    function initSignatureCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      let drawing = false;

      function startDrawing(e) {
        drawing = true;
        const pos = getCoordinates(e, canvas);
        ctx.beginPath();
        ctx.moveTo(pos.x, pos.y);
      }
      function draw(e) {
        if (!drawing) return;
        e.preventDefault();
        const pos = getCoordinates(e, canvas);
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
      }
      function stopDrawing() {
        drawing = false;
        ctx.beginPath();
      }

      canvas.addEventListener("mousedown", startDrawing);
      canvas.addEventListener("mousemove", draw);
      canvas.addEventListener("mouseup", stopDrawing);
      canvas.addEventListener("mouseleave", stopDrawing);
      // Soporte para eventos táctiles
      canvas.addEventListener("touchstart", startDrawing);
      canvas.addEventListener("touchmove", draw);
      canvas.addEventListener("touchend", stopDrawing);
    }

    // Función para limpiar el canvas
    function clearCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Inicializamos los canvas para las firmas
    initSignatureCanvas("firmaRecibido");
    initSignatureCanvas("firmaRealizado");

    // Evento del formulario: copia los datos al área de impresión y convierte las firmas en imágenes
    document.getElementById("serviceForm").addEventListener("submit", function (e) {
      e.preventDefault();
      document.getElementById("pFecha").textContent = document.getElementById("fecha").value;
      document.getElementById("pNombreSolicitante").textContent = document.getElementById("nombreSolicitante").value;
      document.getElementById("pEvaluacion").textContent = document.querySelector('input[name="evaluacion"]:checked').value;
      document.getElementById("pDescripcionActividad").textContent = document.getElementById("descripcionActividad").value;
      document.getElementById("pHoraLlegada").textContent = document.getElementById("horaLlegada").value;
      document.getElementById("pHoraSalida").textContent = document.getElementById("horaSalida").value;
      
      const firmaRecibidoImg = document.getElementById("firmaRecibido").toDataURL();
      const firmaRealizadoImg = document.getElementById("firmaRealizado").toDataURL();
      document.getElementById("pFirmaRecibido").src = firmaRecibidoImg;
      document.getElementById("pFirmaRealizado").src = firmaRealizadoImg;
      
      // Oculta el formulario y muestra el área de impresión
      document.getElementById("serviceForm").style.display = "none";
      document.getElementById("printArea").style.display = "block";
    });

    // Función para volver al inicio
    function volverInicio() {
      location.reload();
    }
  </script>
</body>
</html>