<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <!-- Viewport esencial para dispositivos móviles -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hojas de Entrada y Salida - KMATEQ</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    /* =======================
       ESTILOS BASE
    =========================== */
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f9;
      color: #333;
      line-height: 1.5;
    }
    
    /* =======================
       NAVEGACIÓN Y CONTROLES
    =========================== */
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      padding: 10px;
    }
    nav button {
      background: #0a4275;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    nav button:hover {
      background: #092f5f;
    }
    
    /* =======================
       CONTENEDOR PRINCIPAL
    =========================== */
    .container {
      width: 95%;
      max-width: 1000px;
      margin: 20px auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      padding: 20px;
    }
    
    /* =======================
       ENCABEZADO
    =========================== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #0a4275;
      color: #fff;
      border-radius: 8px 8px 0 0;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .header h1 {
      margin: 0;
      font-size: 2rem;
      text-transform: uppercase;
    }
    .logo {
      height: 60px;
      width: auto;
      max-width: 100%;
    }
    
    /* =======================
       FORMULARIO (HOJA)
    =========================== */
    .form-page {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
      page-break-after: always;
    }
    .form-page h2 {
      margin: 0 0 10px 0;
      color: #0a4275;
      font-size: 1.4rem;
    }
    .form-group {
      margin-bottom: 10px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 0.9rem;
    }
    input[type="text"],
    input[type="date"],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    textarea {
      resize: vertical;
      min-height: 60px;
    }
    
    /* =======================
       AGRUPAR CAMPOS EN FILA
    =========================== */
    .form-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .form-row > .form-group {
      flex: 1;
    }
    /* Con este span se muestra la fecha en impresión */
    .fecha-group .fecha-display { display: none; }
    @media print {
      .fecha-group input { display: none; }
      .fecha-group .fecha-display { display: inline; font-weight: bold; }
      body * { visibility: hidden; }
      #pages, #pages * { visibility: visible; }
      #pages { position: absolute; top: 0; left: 0; width: 100%; }
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("KMATEQ.png") repeat;
        background-size: 300px 300px;
        opacity: 0.1;
        z-index: -1;
        visibility: visible;
      }
    }
    
    /* =======================
       FIRMAS
    =========================== */
    canvas {
      display: block;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      cursor: crosshair;
      width: 100%;
      max-width: 250px;
      height: auto;
    }
    .firma-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    .firma-container > .form-group {
      flex: 1;
      min-width: 250px;
    }
    
    /* =======================
       RESPONSIVIDAD OPTIMIZADA
       Ajustes para pantallas pequeñas muy ajustadas
    =========================== */
    @media only screen and (max-width: 768px) {
      .header {
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      .header h1 { font-size: 1.6rem; margin-bottom: 5px; }
      nav { flex-direction: column; padding: 8px; }
      nav button { width: 100%; font-size: 0.85rem; padding: 8px 10px; }
      .form-row { flex-direction: column; }
      .form-group label { font-size: 0.8rem; }
      input[type="text"],
      input[type="date"],
      select,
      textarea { font-size: 0.8rem; padding: 5px; }
      .firma-container { flex-direction: column; gap: 10px; }
    }
    
    @media only screen and (max-width: 480px) {
      .container {
        width: 100%;
        margin: 0;
        padding: 5px;
        box-shadow: none;
        border-radius: 0;
      }
      .header {
        padding: 5px;
      }
      .header h1 { font-size: 1.4rem; }
      nav button { font-size: 0.8rem; padding: 6px 8px; }
      .form-group label { font-size: 0.75rem; }
      input[type="text"],
      input[type="date"],
      select,
      textarea { font-size: 0.75rem; padding: 4px; }
    }
    
  </style>
</head>
<body>
  <!-- Navegación -->
  <nav>
    <button id="addPage">Generar Hoja</button>
    <button id="savePages">Guardar Hojas</button>
    <button id="loadPages">Cargar Hojas</button>
    <button id="printPages">Imprimir PDF</button>
  </nav>
  <div class="container">
    <div class="header">
      <h1>Hojas de Entrada y Salida KMATEQ</h1>
      <img src="KMATEQ.png" alt="Logo KMATEQ" class="logo">
    </div>
    <!-- Contenedor de hojas -->
    <div id="pages"></div>
  </div>
  <!-- Plantilla para formularios -->
  <template id="pageTemplate">
    <div class="form-page" data-page="{{num}}">
      <h2>Hoja de Entrada y Salida {{num}}</h2>
      <div class="form-group fecha-group">
        <label for="fecha-{{num}}">Fecha:</label>
        <input type="date" id="fecha-{{num}}" name="fecha-{{num}}">
        <span class="fecha-display"></span>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="tipo-equipo-{{num}}">Tipo de Equipo:</label>
          <input type="text" id="tipo-equipo-{{num}}" name="tipo-equipo-{{num}}" placeholder="Ingrese el tipo de equipo">
        </div>
        <div class="form-group">
          <label for="marca-serial-{{num}}">Marca/Modelo:</label>
          <input type="text" id="marca-serial-{{num}}" name="marca-serial-{{num}}" placeholder="Ingrese la marca o modelo">
        </div>
        <div class="form-group">
          <label for="procesador-{{num}}">Procesador:</label>
          <input type="text" id="procesador-{{num}}" name="procesador-{{num}}" placeholder="Ingrese el procesador">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="sn-equipo-{{num}}">SN Equipo:</label>
          <input type="text" id="sn-equipo-{{num}}" name="sn-equipo-{{num}}" placeholder="Ingrese el SN del equipo">
        </div>
        <div class="form-group">
          <label for="serial-kmateq-{{num}}">Serial Kmateq:</label>
          <input type="text" id="serial-kmateq-{{num}}" name="serial-kmateq-{{num}}" placeholder="Ingrese el serial Kmateq">
        </div>
        <div class="form-group">
          <label for="perifericos-{{num}}">Periféricos:</label>
          <input type="text" id="perifericos-{{num}}" name="perifericos-{{num}}" placeholder="Ingrese los periféricos">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Tipo de Disco:</label>
          <div class="radio-group">
            <label><input type="radio" name="disco_duro-{{num}}" value="SSD" checked> SSD</label>
            <label><input type="radio" name="disco_duro-{{num}}" value="HDD"> HDD</label>
          </div>
        </div>
        <div class="form-group">
          <label for="tamanio-disco-{{num}}">Tamaño del Disco:</label>
          <select id="tamanio-disco-{{num}}" name="tamanio-disco-{{num}}">
            <option value="">Seleccione tamaño</option>
            <option value="120GB">120GB</option>
            <option value="240GB">240GB</option>
            <option value="480GB">480GB</option>
            <option value="500GB">500GB</option>
            <option value="1T">1T</option>
            <option value="2T">2T</option>
            <option value="3T">3T</option>
          </select>
        </div>
        <div class="form-group">
          <label for="ram-{{num}}">RAM:</label>
          <select id="ram-{{num}}" name="ram-{{num}}">
            <option value="">Seleccione la memoria</option>
            <option value="2GB">2GB</option>
            <option value="4GB">4GB</option>
            <option value="8GB">8GB</option>
            <option value="12GB">12GB</option>
            <option value="16GB">16GB</option>
            <option value="32GB">32GB</option>
            <option value="64GB">64GB</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="licencia-windows-{{num}}">Licencia Windows:</label>
          <input type="text" id="licencia-windows-{{num}}" name="licencia-windows-{{num}}" placeholder="Ingrese la licencia de Windows">
        </div>
        <div class="form-group">
          <label for="licencia-office-{{num}}">Licencia Office:</label>
          <input type="text" id="licencia-office-{{num}}" name="licencia-office-{{num}}" placeholder="Ingrese la licencia de Office">
        </div>
      </div>
      <div class="form-group">
        <label for="observaciones-{{num}}">Observaciones:</label>
        <textarea id="observaciones-{{num}}" name="observaciones-{{num}}" placeholder="Escriba alguna observación"></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="empresa-entrega-{{num}}">Empresa Quien entrega:</label>
          <input type="text" id="empresa-entrega-{{num}}" name="empresa-entrega-{{num}}" placeholder="Ingrese la empresa que entrega">
        </div>
        <div class="form-group">
          <label for="nombre-entrega-{{num}}">Nombres y Apellidos Quien entrega:</label>
          <input type="text" id="nombre-entrega-{{num}}" name="nombre-entrega-{{num}}" placeholder="Ingrese nombres y apellidos">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="empresa-recibe-{{num}}">Empresa Quien recibe:</label>
          <input type="text" id="empresa-recibe-{{num}}" name="empresa-recibe-{{num}}" placeholder="Ingrese la empresa que recibe">
        </div>
        <div class="form-group">
          <label for="nombre-recibe-{{num}}">Nombres y Apellidos Quien recibe:</label>
          <input type="text" id="nombre-recibe-{{num}}" name="nombre-recibe-{{num}}" placeholder="Ingrese nombres y apellidos">
        </div>
      </div>
      <div class="firma-container">
        <div class="form-group">
          <label>Firma de Quien entrega:</label>
          <canvas id="firma-entrega-{{num}}" width="250" height="125"></canvas>
          <button type="button" onclick="clearCanvas('firma-entrega-{{num}}')">Limpiar Firma</button>
        </div>
        <div class="form-group">
          <label>Firma de Quien recibe:</label>
          <canvas id="firma-recibe-{{num}}" width="250" height="125"></canvas>
          <button type="button" onclick="clearCanvas('firma-recibe-{{num}}')">Limpiar Firma</button>
        </div>
      </div>
    </div>
  </template>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      let pageCount = 0;
      const pagesContainer = document.getElementById("pages");
      
      // Función para añadir una nueva hoja
      function addPage() {
        pageCount++;
        let pageHTML = document.getElementById("pageTemplate").innerHTML.replace(/{{num}}/g, pageCount);
        pagesContainer.insertAdjacentHTML("beforeend", pageHTML);
        setupSignaturePad("firma-entrega-" + pageCount);
        setupSignaturePad("firma-recibe-" + pageCount);
        let newPage = pagesContainer.lastElementChild;
        let dateInput = newPage.querySelector(`#fecha-${pageCount}`);
        let spanDate = newPage.querySelector(".fecha-display");
        dateInput.addEventListener("change", function() {
          spanDate.textContent = this.value;
        });
      }
      
      // Función para limpiar canvas
      window.clearCanvas = function(canvasId) {
        const canvas = document.getElementById(canvasId);
        if (canvas) {
          const ctx = canvas.getContext("2d");
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      };
      
      // Configurar área de firma
      function setupSignaturePad(canvasId) {
        const canvas = document.getElementById(canvasId);
        if (!canvas) return;
        const ctx = canvas.getContext("2d");
        let drawing = false;
        canvas.addEventListener("mousedown", function(e) {
          drawing = true;
          ctx.beginPath();
          const rect = canvas.getBoundingClientRect();
          ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        });
        canvas.addEventListener("mousemove", function(e) {
          if (!drawing) return;
          const rect = canvas.getBoundingClientRect();
          ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
          ctx.strokeStyle = "#000";
          ctx.lineWidth = 2;
          ctx.lineCap = "round";
          ctx.stroke();
        });
        canvas.addEventListener("mouseup", function() {
          drawing = false;
        });
        canvas.addEventListener("touchstart", function(e) {
          e.preventDefault();
          drawing = true;
          const rect = canvas.getBoundingClientRect();
          const touch = e.touches[0];
          ctx.beginPath();
          ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
        });
        canvas.addEventListener("touchmove", function(e) {
          e.preventDefault();
          if (!drawing) return;
          const rect = canvas.getBoundingClientRect();
          const touch = e.touches[0];
          ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
          ctx.strokeStyle = "#000";
          ctx.lineWidth = 2;
          ctx.lineCap = "round";
          ctx.stroke();
        });
        canvas.addEventListener("touchend", function(e) {
          e.preventDefault();
          drawing = false;
        });
      }
      
      // Guardar y cargar hojas con localStorage
      function saveHojas() {
        const hojas = [];
        document.querySelectorAll(".form-page").forEach(page => {
          const hoja = {};
          hoja.num = page.getAttribute("data-page");
          hoja.fecha = page.querySelector("input[type='date']").value || "";
          hoja.tipoEquipo = page.querySelector("input[id^='tipo-equipo-']").value || "";
          hoja.marcaSerial = page.querySelector("input[id^='marca-serial-']").value || "";
          hoja.procesador = page.querySelector("input[id^='procesador-']").value || "";
          hoja.snEquipo = page.querySelector("input[id^='sn-equipo-']").value || "";
          hoja.serialKmateq = page.querySelector("input[id^='serial-kmateq-']").value || "";
          hoja.perifericos = page.querySelector("input[id^='perifericos-']").value || "";
          hoja.tamanioDisco = page.querySelector("select[id^='tamanio-disco-']").value || "";
          hoja.ram = page.querySelector("select[id^='ram-']").value || "";
          hoja.licenciaWindows = page.querySelector("input[id^='licencia-windows-']").value || "";
          hoja.licenciaOffice = page.querySelector("input[id^='licencia-office-']").value || "";
          hoja.observaciones = page.querySelector("textarea[id^='observaciones-']").value || "";
          hoja.empresaEntrega = page.querySelector("input[id^='empresa-entrega-']").value || "";
          hoja.nombreEntrega = page.querySelector("input[id^='nombre-entrega-']").value || "";
          hoja.empresaRecibe = page.querySelector("input[id^='empresa-recibe-']").value || "";
          hoja.nombreRecibe = page.querySelector("input[id^='nombre-recibe-']").value || "";
          const canvasEntrega = page.querySelector("canvas[id^='firma-entrega-']");
          const canvasRecibe = page.querySelector("canvas[id^='firma-recibe-']");
          hoja.firmaEntrega = canvasEntrega ? canvasEntrega.toDataURL() : "";
          hoja.firmaRecibe = canvasRecibe ? canvasRecibe.toDataURL() : "";
          hojas.push(hoja);
        });
        localStorage.setItem("formHojas", JSON.stringify(hojas));
        alert("Hojas guardadas en el navegador.");
      }
      
      function loadHojas() {
        const hojas = JSON.parse(localStorage.getItem("formHojas")) || [];
        pagesContainer.innerHTML = "";
        pageCount = 0;
        hojas.forEach(hoja => {
          pageCount++;
          let pageHTML = document.getElementById("pageTemplate").innerHTML.replace(/{{num}}/g, pageCount);
          pagesContainer.insertAdjacentHTML("beforeend", pageHTML);
          let page = pagesContainer.lastElementChild;
          page.setAttribute("data-page", pageCount);
          page.querySelector(`#fecha-${pageCount}`).value = hoja.fecha;
          page.querySelector(`#fecha-${pageCount}`).dispatchEvent(new Event("change"));
          page.querySelector(`#tipo-equipo-${pageCount}`).value = hoja.tipoEquipo;
          page.querySelector(`#marca-serial-${pageCount}`).value = hoja.marcaSerial;
          page.querySelector(`#procesador-${pageCount}`).value = hoja.procesador;
          page.querySelector(`#sn-equipo-${pageCount}`).value = hoja.snEquipo;
          page.querySelector(`#serial-kmateq-${pageCount}`).value = hoja.serialKmateq;
          page.querySelector(`#perifericos-${pageCount}`).value = hoja.perifericos;
          page.querySelector(`#tamanio-disco-${pageCount}`).value = hoja.tamanioDisco;
          page.querySelector(`#ram-${pageCount}`).value = hoja.ram;
          page.querySelector(`#licencia-windows-${pageCount}`).value = hoja.licenciaWindows;
          page.querySelector(`#licencia-office-${pageCount}`).value = hoja.licenciaOffice;
          page.querySelector(`#observaciones-${pageCount}`).value = hoja.observaciones;
          page.querySelector(`#empresa-entrega-${pageCount}`).value = hoja.empresaEntrega;
          page.querySelector(`#nombre-entrega-${pageCount}`).value = hoja.nombreEntrega;
          page.querySelector(`#empresa-recibe-${pageCount}`).value = hoja.empresaRecibe;
          page.querySelector(`#nombre-recibe-${pageCount}`).value = hoja.nombreRecibe;
          const canvasEntrega = page.querySelector(`#firma-entrega-${pageCount}`);
          const canvasRecibe = page.querySelector(`#firma-recibe-${pageCount}`);
          if (canvasEntrega && hoja.firmaEntrega) {
            let imgEntrega = new Image();
            imgEntrega.onload = function() {
              canvasEntrega.getContext("2d").drawImage(imgEntrega, 0, 0);
            };
            imgEntrega.src = hoja.firmaEntrega;
          }
          if (canvasRecibe && hoja.firmaRecibe) {
            let imgRecibe = new Image();
            imgRecibe.onload = function() {
              canvasRecibe.getContext("2d").drawImage(imgRecibe, 0, 0);
            };
            imgRecibe.src = hoja.firmaRecibe;
          }
          setupSignaturePad("firma-entrega-" + pageCount);
          setupSignaturePad("firma-recibe-" + pageCount);
          let dateInput = page.querySelector(`#fecha-${pageCount}`);
          let spanDate = page.querySelector(".fecha-display");
          dateInput.addEventListener("change", function() {
            spanDate.textContent = this.value;
          });
        });
        alert("Hojas cargadas desde el navegador.");
      }
      
      addPage();
      
      document.getElementById("addPage").addEventListener("click", addPage);
      document.getElementById("savePages").addEventListener("click", saveHojas);
      document.getElementById("loadPages").addEventListener("click", loadHojas);
      document.getElementById("printPages").addEventListener("click", function() {
        window.print();
      });
    });
  </script>
</body>
</html>